name: CI DEV

on:
  push:
    branches: ["dev"]

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install dependencies
        run: npm install

      - name: Detect changed files
        id: changed
        run: |
          FILES=$(git diff --name-only HEAD~1 HEAD | grep "^src/main")
          echo "Detected changed:"
          echo "$FILES"

          if [ -z "$FILES" ]; then
            echo "No matching files changed. Skipping."
            echo "run=false" >> $GITHUB_OUTPUT
            exit 0
          fi

          # Kirim banyak file ke output
          echo "files=$(echo $FILES | tr '\n' ' ')" >> $GITHUB_OUTPUT
          echo "run=true" >> $GITHUB_OUTPUT

      - name: Run scripts for each file
        if: steps.changed.outputs.run == 'true'
        run: |
          for FILE in ${{ steps.changed.outputs.files }}; do
            NAME=$(basename "$FILE" .ts)
            echo "â–¶ Running: npm run dev $NAME"
            npm run dev $NAME
          done
